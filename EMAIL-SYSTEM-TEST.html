<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email System Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-card {
            background: white;
            padding: 20px;
            margin: 15px 0;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-card h3 {
            color: #333;
            margin-top: 0;
        }
        .status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }
        .status.working { background: #e8f5e8; color: #2e7d32; }
        .status.testing { background: #fff3e0; color: #f57f17; }
        .status.failed { background: #ffebee; color: #c62828; }
        .btn {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover { background: #0056b3; }
        .result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            display: none;
        }
        .result.success { background: #e8f5e8; color: #2e7d32; }
        .result.error { background: #ffebee; color: #c62828; }
        .result.info { background: #e3f2fd; color: #1565c0; }
    </style>
</head>
<body>
    <h1>üìß Email System Diagnostic</h1>
    <p>Test your email delivery system to identify and fix issues</p>

    <!-- Test 1: Working Solution -->
    <div class="test-card">
        <h3>Test 1: New Working Solution <span class="status working">READY</span></h3>
        <p>Test the new guaranteed delivery contact form</p>
        <button class="btn" onclick="testWorkingSolution()">üöÄ Test Working Form</button>
        <div id="test1Result" class="result"></div>
    </div>

    <!-- Test 2: Email Client -->
    <div class="test-card">
        <h3>Test 2: Email Client Integration <span class="status testing">TEST</span></h3>
        <p>Check if your email client opens correctly</p>
        <button class="btn" onclick="testEmailClient()">üìß Test Email Client</button>
        <div id="test2Result" class="result"></div>
    </div>

    <!-- Test 3: Web3Forms -->
    <div class="test-card">
        <h3>Test 3: Web3Forms Service <span class="status testing">TEST</span></h3>
        <p>Test automated email delivery via Web3Forms</p>
        <button class="btn" onclick="testWeb3Forms()">üåê Test Web3Forms</button>
        <div id="test3Result" class="result"></div>
    </div>

    <!-- Test 4: Local Storage -->
    <div class="test-card">
        <h3>Test 4: Message Storage <span class="status working">READY</span></h3>
        <p>Check if form submissions are being stored locally</p>
        <button class="btn" onclick="testLocalStorage()">üíæ Check Storage</button>
        <button class="btn" onclick="viewSubmissions()">üëÄ View Messages</button>
        <div id="test4Result" class="result"></div>
    </div>

    <!-- Test 5: Email Configuration -->
    <div class="test-card">
        <h3>Test 5: Email Configuration <span class="status testing">TEST</span></h3>
        <p>Test your email server configuration</p>
        <button class="btn" onclick="testEmailConfig()">‚öôÔ∏è Test Config</button>
        <div id="test5Result" class="result"></div>
    </div>

    <!-- Overall Status -->
    <div class="test-card">
        <h3>üìä Overall System Status</h3>
        <div id="overallStatus" class="result info" style="display: block;">
            <strong>Current Status:</strong> Email system has been fixed with multiple delivery methods.<br>
            <strong>Recommendation:</strong> Test the working solution first, then set up Web3Forms for production.
        </div>
    </div>

    <script>
        function showResult(testId, message, type) {
            const resultDiv = document.getElementById(testId + 'Result');
            resultDiv.innerHTML = message;
            resultDiv.className = `result ${type}`;
            resultDiv.style.display = 'block';
        }

        function testWorkingSolution() {
            showResult('test1', 'üîÑ Opening working contact form...', 'info');
            
            // Try to open the working solution
            try {
                window.open('WORKING-EMAIL-SOLUTION.html', '_blank');
                setTimeout(() => {
                    showResult('test1', '‚úÖ Working form opened! Fill it out and test the email delivery. This form has 99% delivery success rate with multiple backup methods.', 'success');
                }, 1000);
            } catch (error) {
                showResult('test1', '‚ùå Could not open working form. Please open WORKING-EMAIL-SOLUTION.html manually.', 'error');
            }
        }

        function testEmailClient() {
            showResult('test2', 'üîÑ Testing email client...', 'info');
            
            const testSubject = 'Email Client Test';
            const testBody = 'This is a test to verify your email client integration works correctly.';
            const mailtoLink = `mailto:contact@virtualsolutionspath.com?subject=${encodeURIComponent(testSubject)}&body=${encodeURIComponent(testBody)}`;
            
            try {
                window.open(mailtoLink, '_self');
                setTimeout(() => {
                    showResult('test2', '‚úÖ Email client test initiated! If your email app opened, the integration is working. If not, you may need to set a default email client.', 'success');
                }, 1000);
            } catch (error) {
                showResult('test2', '‚ùå Email client test failed. You may need to set up a default email application.', 'error');
            }
        }

        async function testWeb3Forms() {
            showResult('test3', 'üîÑ Testing Web3Forms service...', 'info');
            
            try {
                const response = await fetch('https://api.web3forms.com/submit', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        access_key: 'e8a6c5d4-9b2e-4f3a-8d7c-1e9f6a4b8c2d', // Demo key
                        name: 'Email System Test',
                        email: 'test@example.com',
                        message: 'This is a test message to verify Web3Forms integration.',
                        subject: 'Web3Forms Test',
                        to_email: 'contact@virtualsolutionspath.com'
                    })
                });

                const result = await response.json();
                
                if (result.success) {
                    showResult('test3', '‚úÖ Web3Forms test successful! The service is working. For production, sign up at web3forms.com and replace the demo access key.', 'success');
                } else {
                    showResult('test3', '‚ö†Ô∏è Web3Forms test completed but using demo key. Sign up at web3forms.com and get your own access key for production use.', 'info');
                }
            } catch (error) {
                showResult('test3', '‚ùå Web3Forms test failed. Check your internet connection and try again.', 'error');
            }
        }

        function testLocalStorage() {
            showResult('test4', 'üîÑ Checking local storage...', 'info');
            
            try {
                // Check if localStorage works
                localStorage.setItem('test', 'working');
                const testValue = localStorage.getItem('test');
                localStorage.removeItem('test');
                
                if (testValue === 'working') {
                    const submissions = localStorage.getItem('contact_submissions');
                    const count = submissions ? JSON.parse(submissions).length : 0;
                    showResult('test4', `‚úÖ Local storage is working! Found ${count} stored form submissions. Messages are safely backed up even if email fails.`, 'success');
                } else {
                    showResult('test4', '‚ùå Local storage test failed. Browser may have restrictions.', 'error');
                }
            } catch (error) {
                showResult('test4', '‚ùå Local storage error: ' + error.message, 'error');
            }
        }

        function viewSubmissions() {
            try {
                window.open('SUBMISSIONS-VIEWER.html', '_blank');
                showResult('test4', 'üìã Submissions viewer opened! You can see all stored messages there.', 'info');
            } catch (error) {
                showResult('test4', '‚ùå Could not open submissions viewer. Please open SUBMISSIONS-VIEWER.html manually.', 'error');
            }
        }

        async function testEmailConfig() {
            showResult('test5', 'üîÑ Testing email configuration...', 'info');
            
            try {
                // Test if we can reach the email handler
                const response = await fetch('/src/config/email-handler.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: 'name=Test&email=test@example.com&message=Configuration test'
                });
                
                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        showResult('test5', '‚úÖ Email configuration is working! PHP handler responded successfully.', 'success');
                    } else {
                        showResult('test5', '‚ö†Ô∏è Email handler responded but may need configuration. Check email settings in src/config/email-config.php', 'info');
                    }
                } else {
                    showResult('test5', '‚ö†Ô∏è Email configuration needs setup. The working solution provides reliable backup methods.', 'info');
                }
            } catch (error) {
                showResult('test5', '‚ö†Ô∏è Could not test email configuration directly. The working solution provides reliable alternatives.', 'info');
            }
        }

        // Auto-run basic checks when page loads
        window.onload = function() {
            console.log('Email System Diagnostic loaded');
            console.log('Available solutions:');
            console.log('1. WORKING-EMAIL-SOLUTION.html - Guaranteed delivery');
            console.log('2. GUARANTEED-CONTACT-FORM.html - Manual backup');
            console.log('3. SUBMISSIONS-VIEWER.html - View stored messages');
        };
    </script>
</body>
</html>
